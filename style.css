body {
  background-color: #000;
  color: white;
  font-family: 'Segoe UI', sans-serif;
  margin: 0;
  padding: 2rem;
}
.container {
  display: flex;
  flex-wrap: wrap; 
  justify-content: center; 
  gap: 2rem;
  align-items: stretch; /* Это заставит карточки растягиваться по высоте самой высокой */
}
.card {
  background-color: #111;
  border-radius: 20px;
  padding: 1.5rem; 
  width: 360px; 
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
  display: flex; 
  flex-direction: column;
}

.card h1 {
  font-size: 1.5rem;
  margin-top: 0;
  margin-bottom: 1rem; 
  text-align: left; /* Вернули выравнивание по левому краю */
}
.card .total, .card .status {
  margin-top: 0; 
  margin-bottom: 0.5rem; 
  text-align: left; /* Вернули выравнивание по левому краю */
}
.card .total strong, .card .status strong {
    display: block; 
}

.card h2, .card h3 { 
  margin-top: 1rem;
  margin-bottom: 0.5rem;
  font-size: 1.2rem;
  text-align: left; /* Вернули выравнивание по левому краю */
}
.card p { 
  font-size: 0.95rem;
  line-height: 1.4;
  margin-bottom: 0.75rem; 
  text-align: left; /* Вернули выравнивание по левому краю */
}
.ai-card h1 + p#aiGeneralAdvice { 
    margin-top: 0.5rem;
}

.legend {
  list-style: none;
  padding: 0;
  margin-top: 0.5rem; 
  width: 100%; 
  /* flex-grow: 1; /* Убрал, чтобы легенда не растягивалась чрезмерно, если мало элементов */
  /* overflow-y: auto; */
}
.legend li {
  margin: 0.3rem 0;
  display: flex;
  align-items: center;
  font-size: 0.9rem; 
}
.legend-item-text { 
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis; 
    flex-grow: 1; 
}
.dot { height: 10px; width: 10px; display: inline-block; border-radius: 50%; margin-right: 8px; flex-shrink: 0;}
.purple { background-color: #a259ff; } .gold { background-color: #f1c40f; } .blue { background-color: #3498db; } .green { background-color: #2ecc71; } .grey { background-color: #95a5a6; } .red { background-color: #e74c3c; } .orange { background-color: #e67e22; }

.chart-total {
  text-align: center; 
  font-size: 1.1rem; 
  margin-top: 0.5rem; 
  margin-bottom: 0.5rem;
  color: #fff;
}

#mainChart, #stockChart {
  max-width: 100%; 
  width: 320px !important;  
  height: 320px !important; 
  display: block; 
  margin: 0.5em auto; /* Уменьшен отступ для лучшего выравнивания */
  flex-shrink: 0; 
}

.upload-section { margin-top: 3rem; background-color: #111; padding: 2rem; border-radius: 16px; text-align: center; }
.ai-card {} 

#breakdownCard.visible, .ai-card.visible {
  display: flex !important; 
  flex-direction: column;
  opacity: 1 !important;
  transform: scale(1) !important;
}

#aiCard #aiDynamicRecommendations { /* Блок с AI рекомендациями должен растягиваться */
    flex-grow: 1;
    overflow-y: auto; 
}

#lang-toggle-container { position: fixed; bottom: 20px; right: 20px; background-color: #111; padding: 10px 12px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
#langSelect { background: #222; color: #fff; border: none; padding: 4px 8px; border-radius: 5px; }
.status strong { background: none !important; }

/* Стили для попапов */
.popup-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.85); display: none; justify-content: center; align-items: center; z-index: 9999; backdrop-filter: blur(3px); }
.popup { background-color: #1e1e1e; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 25px rgba(0, 0, 0, 0.4); width: 340px; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; border: 1px solid #333; }
.popup h2 { margin-top: 0; margin-bottom: 1.5rem; font-size: 1.4rem; color: #b388ff; text-align: center; font-weight: 600; }
.popup p#deleteConfirmMessage { /* Специфичный стиль для текста подтверждения */ text-align: center; margin-bottom: 1.5rem; font-size: 1rem; line-height: 1.5; }
.popup label { display: block; margin-top: 1rem; margin-bottom: 0.25rem; font-size: 0.9rem; color: #bbb; font-weight: 500; }
.popup input[type="text"], .popup input[type="number"] { width: calc(100% - 1.2rem); padding: 0.6rem; margin-top: 0.2rem; border: 1px solid #444; border-radius: 8px; background: #282828; color: #e0e0e0; font-size: 0.95rem; }
.popup input[type="text"]:focus, .popup input[type="number"]:focus { outline: none; border-color: #b388ff; box-shadow: 0 0 0 2px rgba(179, 136, 255, 0.3); }
.popup-actions { display: flex; justify-content: flex-end; gap: 0.75rem; margin-top: 2rem; }
.popup .save-btn, .popup .cancel-btn, .popup .delete-btn-confirm { border: none; padding: 0.65rem 1.3rem; border-radius: 8px; color: white; cursor: pointer; transition: background-color 0.2s ease, transform 0.1s ease; font-weight: 500; font-size: 0.95rem; }
.popup .save-btn:active, .popup .cancel-btn:active, .popup .delete-btn-confirm:active { transform: translateY(1px); }
.popup .save-btn { background-color: #7e57c2; } .popup .save-btn:hover { background-color: #9575cd; }
.popup .delete-btn-confirm { background-color: #e53935; } .popup .delete-btn-confirm:hover { background-color: #ef5350; }
.popup .cancel-btn { background-color: #424242; color: #ccc; } .popup .cancel-btn:hover { background-color: #555555; }

/* Стили для AI Assistant Details */
#aiDynamicRecommendations h3 { font-size: 1.1em; color: #c5a5ff; margin-top: 0.5em; margin-bottom: 0.8em; }
#aiDynamicRecommendations h4 { font-size: 1em; color: #aaa; margin-top: 1em; margin-bottom: 0.3em; }
.ai-item { margin-bottom: 1.2em; padding-bottom: 0.8em; border-bottom: 1px solid #2a2a2a; }
.ai-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
.ai-short-summary { margin-bottom: 0.4em; line-height: 1.5; }
.ai-short-summary strong { color: #e0e0e0; } 
.show-details-btn { background-color: #383838; color: #ccc; border: 1px solid #4d4d4d; padding: 0.25em 0.6em; font-size: 0.8em; border-radius: 5px; cursor: pointer; margin-left: 0.5em; vertical-align: middle; }
.show-details-btn:hover { background-color: #4a4a4a; border-color: #666; }
.ai-detailed-summary { background-color: rgba(40, 40, 40, 0.5); padding: 0.75em; border-radius: 6px; font-size: 0.9em; line-height: 1.5; margin-top: 0.5em; border: 1px solid #2f2f2f; }
.ai-detailed-summary p { margin-top: 0.3em; margin-bottom: 0.3em; }
.ai-detailed-summary p:first-child { margin-top: 0; }
.ai-detailed-summary p:last-child { margin-bottom: 0; }